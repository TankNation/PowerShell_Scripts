#############################################################################################################################################
###~ Domain Users Compliance Remediation ####################################################################################################
#
#~ Brian Tancredi
#~ Created: 2017-02-16
#~ Modified: 2017-02-16
#
#~ References:
#
#############################################################################################################################################

#############################################################################################################################################
###~ Assigning Variables and Functions ######################################################################################################
#############################################################################################################################################
 
$computer = $env:computername
$local_Groups = @(
    "Administrators",
    "Users"
)
$domain_Groups = @(
    "Domain1\Domain Users",
    "Domain2\Domain Users",
    "Domain3\Domain Users"
)

function compliance_Remidiate{
    foreach ($local_Group in $local_Groups){
        $member_List = net localgroup $local_Group | where {$_ -AND $_ -notmatch “command completed successfully”} | select -skip 4
        foreach ($domain_Group in $domain_Groups){
            If ($member_List -contains $domain_Group){
                $adsi_Group = ($domain_Group -replace "\\", '/')
                Try{([ADSI]"WinNT://$computer/$local_Group,group").psbase.Invoke("Remove",([ADSI]"WinNT://$adsi_Group").path)}
                Catch{}
            }
        }
    }
}#~ Function checks $local_Groups for presence of $domain_Groups and if present Removes them

#############################################################################################################################################
###~ Run Checks against Local Administrator and Local User groups ###########################################################################
#############################################################################################################################################

#~ Remediates the $local_Groups by removing presence of $domain_Groups
compliance_Remidiate

#############################################################################################################################################
#~ END ######################################################################################################################################
#############################################################################################################################################